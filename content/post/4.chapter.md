+++
author = ""
date = "2017-02-17T11:17:20+09:00"
description = ""
tags = []
title = "4.chapter"
draft = true
+++

## 드래그 앤드 드롭
* 구현의 어려움
  * 최근까지 브라우저용 표준 API 가 존재하지 않음.
  * 브라우저 공급 업체별로 일관성 없는 API, 모바일 환경에서의 오작동
* 리액트 DnD
  * 내부적으로 이용 가능한 API(데스크탑 브라우저의 경우 기본 HTML5 API)에 플러그인 방식으로 연결
  * 호환되지 않는 부분이나 특이성을 관리하고 구현 세부사항을 숨김
  * `npm install --save react-dnd@2.x.x react-dnd-html5-backend@1.x.x`

### 리액트 DnD 구현 개요
* 리액트 DnD 라이브러리는 고차 컴포넌트를 이용해 구현된다.
  * 고차 컴포넌트: 컴포넌트를 매개변수로 받고 여기에 기능을 추가한 컴포넌트를 반환하는 자바스크립트 함수
  * 세 가지의 고차 컴포넌트 존재
    * `DragSource`
    * `DropTarget`
    * `DragDropContext`
  * 자바스크립트 데코레이터를 이용하는 방법도 지원
    * 아직 실험 단계
    * ES 2015 사양에 포함되지 않았음

### 리액트 DnD 예제 구현

#### Container 컴포넌트
``` javascript
import React, { Component } from 'react';
import ShoppingCart from './ShoppingCart';
import Snack from './Snack';
import { DragDropContext } from 'react-dnd';
import HTML5Backend from 'react-dnd-html5-backend';

class Container extends Component {
    render() {
        return (
            <div>
                <Snack name='Chips' />
                <Snack name='Cupcake' />
                <Snack name='Donut' />
                <Snack name='Doritos' />
                <Snack name='Popcorn' />
                <ShoppingCart/>
            </div>
        );
    }
}

export default DragDropContext(HTML5Backend)(Container);
```

#### DragSource 와 DropTarget 고차 컴포넌트(Higher-Order Component)
`DragSource` 와 `DropTarget` 에는 약간의 사전 준비 설정(규약)이 필요하다.
* 타입
  * 컴포넌트의 이름
  * 복잡한 UI 의 경우 컴포넌트 각각을 고유하게 식별하기 위한 값
* 사양 객체(spec object)
  * 드래그 앤 드롭 이벤트에 "반응"하는 방법을 지정
  * 사양은 드래그 앤 드롭 상호 작용이 수행될 때 호출되는 함수를 포함하는 일반 자바스크립트 객체
    * 호출되는 함수
      * `DragSource`
        * `beginDrag(props, monitor, component)`: Required
        * `endDrag(props, monitor, component)`: Optional
        * `canDrag(props, monitor)`: Optional
        * `isDragging(props, monitor)`: Optional
      * `DropTarget`
        * `drop(props, monitor, component)`: Optional
        * `hover(props, monitor, component)`: Optional
        * `canDrop(props, monitor)`: Optional
* 콜렉팅 함수
  * 리액트 DnD 에서 해당 컴포넌트로 속성을 전달하기 위한 일종의 콜백 함수
  * Monitors
    * `드래그 앤 드롭` 은 상태가 필요하며 상태의 변화에 따라 컴포넌트의 모습도 변경되어야 한다.
    * Monitors 를 통해 `드래그 앤 드롭` 의 상태가 변경될 때마다 해당 컴포넌트의 Props 를 업데이트 할 수 있다.
  * Connectors
    * Connectors 를 통해 DOM 노드에 미리 정의된 role(a drag source, a drag preview or a drop target) 을 부여할 수 있다.

#### ShoppingCart 컴포넌트
``` javascript
import React, { Component } from 'react';
import { DropTarget } from 'react-dnd';

const ShoppingCartSpec = {
    drop() {
        return { name: 'ShoppingCart'};
    }
};

let collect = (connect, monitor) => {
    return {
        connectDropTarget: connect.dropTarget(),
        isOver: monitor.isOver(),
        canDrop: monitor.canDrop()
    };
};

class ShoppingCart extends Component {
    render() {
        const { canDrop, isOver, connectDropTarget } = this.props;
        const isActive = canDrop && isOver;

        let backgroundColor = '#ffffff';
        if(isActive) {
            backgroundColor = '#f7f7BD';
        } else if (canDrop) {
            backgroundColor = '#f7f7f7';
        }

        const style = {
            backgroundColor: backgroundColor
        };

        return (
            <div className='shopping-cart' style={style}>
                {isActive ?
                    'Hummmm, snack!' :
                    'Drag here to order!'
                }
            </div>
        );
    }
}

ShoppingCart.propTypes = {
    connectDropTarget: PropTypes.func.isRequired,
    isOver: PropTypes.bool.isRequired,
    canDrop: PropTypes.bool.isRequired
}

export default DropTarget("snack", ShoppingCartSpec, collect)(ShoppingCart);
```

#### Snack 컴포넌트
``` javascript
import React, { Component, PropTypes } from 'react';
import { DragSource } from 'react-dnd';
import constants from './constants';

const snackSpec = {
    beginDrag(props) {
        return {
            name: props.name
        };
    },
    endDrag(props, monitor) {
        const dragItem = monitor.getItem();
        const dropResult = monitor.getDropResult();

        if (dropResult) {
            console.log(`You dropped ${dragItem.name} into ${dropResult.name}`);
        }
    }
}

let collect = (connect, monitor) => {
    return {
        connectDragSource: connect.dragSource(),
        isDragging: monitor.isDragging()
    };
}

class Snack extends Component {
    render() {
        const { name, isDragging, connectDragSource } = this.props;
        const opacity = isDragging ? 0.4 : 1;

        const style = {
            opacity: opacity
        };

        return (
            connectDragSource (
                <div className='snack' style={style}>
                    {name}
                </div>
            )
        );
    }
}

Snack.propTypes = {
    name: PropTypes.string.isRequired
};

export default DragSource(constants.SNACK, snackSpec, collect)(Snack);
```
